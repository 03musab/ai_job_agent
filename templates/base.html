<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title | default('JobSnap') }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#0a0a0f',
                            100: '#1a1a2e',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            900: '#312e81'
                        },
                        gray: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        },
                        temporal: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        },
                        neon: {
                            cyan: '#00ffff',
                            purple: '#a855f7',
                            pink: '#ec4899',
                            green: '#10b981'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-primary: #6366f1;
            --color-primary-dark: #4f46e5;
            --color-gray-50: #f8fafc;
            --color-gray-100: #f1f5f9;
            --color-gray-900: #0f172a;
            --color-dark-bg: #0a0a0f;
            --color-dark-surface: #1a1a2e;
            --color-dark-elevated: #16213e;
            --color-neon-cyan: #00ffff;
            --color-neon-purple: #a855f7;
            --color-neon-pink: #ec4899;
            --shadow-dark: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            --shadow-dark-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
            --shadow-neon: 0 0 20px rgba(99, 102, 241, 0.3);
            --shadow-neon-cyan: 0 0 20px rgba(0, 255, 255, 0.2);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            background-color: #0f172a; /* bg-gray-900 */
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden; /* Prevent horizontal scrollbars */
            scroll-behavior: smooth; /* Enable smooth scrolling */
        }

        /* Optimized Panning Background */
        body::after { display: none; }

        /* Temporal grid overlay (remains the same) */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        /* Keyframes for the optimized background animation */
        @keyframes background-pan {
            0% { transform: translateX(-10%) translateY(5%); }
            50% { transform: translateX(10%) translateY(-5%); }
            100% { transform: translateX(-10%) translateY(5%); }
        }

        /* Temporal glow effects */
        .temporal-glow {
            position: relative;
        }
        .temporal-glow::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--color-neon-cyan), var(--color-neon-purple), var(--color-neon-pink));
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
            animation: temporalPulse 3s ease-in-out infinite alternate;
            will-change: opacity; /* Hint for GPU acceleration */
        }
        .temporal-glow:hover::before {
            opacity: 0.7;
        }

        @keyframes temporalPulse {
            0% { opacity: 0.1; }
            100% { opacity: 0.3; }
        }
        
        /* Modern Flash Messages - Dark Theme */
        .flash-message {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-dark-lg);
            color: white;
            font-weight: 500;
            font-size: 0.875rem;
            max-width: 400px;
            backdrop-filter: blur(12px);
            animation: slideInRight 0.3s ease-out, fadeout 4s 1s forwards;
            border: 1px solid rgba(255, 255, 255, 0.1);
            will-change: transform, opacity;
        }

        .flash-success { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%);
            border-left: 4px solid #10b981;
            box-shadow: var(--shadow-dark-lg), 0 0 20px rgba(16, 185, 129, 0.3);
        }
        .flash-danger { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%);
            border-left: 4px solid #ef4444;
            box-shadow: var(--shadow-dark-lg), 0 0 20px rgba(239, 68, 68, 0.3);
        }
        .flash-warning { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(217, 119, 6, 0.9) 100%);
            border-left: 4px solid #f59e0b;
            color: #1f2937;
            box-shadow: var(--shadow-dark-lg), 0 0 20px rgba(245, 158, 11, 0.3);
        }
        .flash-info { 
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9) 0%, rgba(79, 70, 229, 0.9) 100%);
            border-left: 4px solid var(--color-primary);
            box-shadow: var(--shadow-dark-lg), var(--shadow-neon);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeout {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }
        
        /* Modern Tooltip System - Dark Theme */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            min-width: 120px;
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            text-align: center;
            border-radius: var(--radius-md);
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1), transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: var(--shadow-dark-lg);
            border: 1px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(8px);
            will-change: transform, opacity;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(15, 23, 42, 0.95) transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }
        
        /* Enhanced UX Styles - Dark Theme */
        .job-item {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(8px);
            will-change: transform, box-shadow;
        }

        .job-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-dark-lg), var(--shadow-neon);
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(26, 26, 46, 0.9);
        }
        
        .skeleton {
            background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            max-width: 500px;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .toast.show {
            transform: translateX(0);
        }
        
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                box-shadow: 0 0 10px currentColor;
            }
            50% { 
                opacity: .5;
                box-shadow: 0 0 20px currentColor;
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .button-loading {
            position: relative;
            color: transparent !important;
        }
        .button-loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Badges */
        .status-badge.status-new {
            background-color: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border-color: rgba(59, 130, 246, 0.3);
        }
        .status-badge.status-applied {
            background-color: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border-color: rgba(16, 185, 129, 0.3);
        }
        .status-badge.status-interview {
            background-color: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border-color: rgba(245, 158, 11, 0.3);
        }
        .status-badge.status-offered {
            background-color: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            border-color: rgba(139, 92, 246, 0.3);
        }
        .status-badge.status-rejected {
            background-color: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border-color: rgba(239, 68, 68, 0.3);
        }
        .status-badge.status-archived {
            background-color: rgba(107, 114, 128, 0.15);
            color: #9ca3af;
            border-color: rgba(107, 114, 128, 0.3);
        }

        /* Chart Legend Dots */
        .chart-legend-dot {
            width: 0.625rem; /* w-2.5 */
            height: 0.625rem; /* h-2.5 */
            border-radius: 9999px; /* rounded-full */
        }
        .chart-legend-blue { background-color: #3B82F6; }
        .chart-legend-emerald { background-color: #10B981; }
        .chart-legend-amber { background-color: #F59E0B; }
        .chart-legend-purple { background-color: #8B5CF6; }
        .chart-legend-red { background-color: #EF4444; }
        .chart-legend-gray { background-color: #6B7280; }

        .btn-analysis {
            background-color: rgba(14, 165, 233, 0.1); /* sky-500/10 */
            color: #38bdf8; /* sky-400 */
            border-color: rgba(14, 165, 233, 0.2);
        }
        .btn-analysis:hover {
            background-color: rgba(14, 165, 233, 0.2);
            color: #7dd3fc; /* sky-300 */
        }

        /* Temporal enhancements */
        .nav-glass {
            background: rgba(10, 10, 15, 0.8);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(16px);
            will-change: transform; /* For smooth sticky behavior */
        }

        .btn-temporal {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.8) 0%, rgba(79, 70, 229, 0.8) 100%);
            border: 1px solid rgba(99, 102, 241, 0.4);
            color: white;
            transition: box-shadow 0.3s ease, border-color 0.3s ease, transform 0.3s ease, text-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-temporal:hover {
            box-shadow: var(--shadow-neon);
            border-color: rgba(99, 102, 241, 0.9);
            transform: translateY(-3px); /* Slightly more pronounced effect */
            /* New Stuff: Add a subtle glow to the button text on hover */
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .btn-temporal::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .btn-temporal:hover::before {
            left: 100%;
        }

        .text-temporal {
            background: linear-gradient(135deg, var(--color-neon-cyan), var(--color-neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Page Loader Spinner */
        .loader-spinner {
            width: 56px; /* w-14 */
            height: 56px; /* h-14 */
            border: 5px solid rgba(99, 102, 241, 0.2); /* border-indigo-500/20 */
            border-top-color: #a855f7; /* neon-purple */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Mobile menu dark theme */
        .mobile-menu-dark {
            background: rgba(10, 10, 15, 0.95);
            border-top: 1px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(16px);
        }

        /* Content fade-in animation */
        .content-fade-in {
            animation: fadeInAnimation 0.7s ease-in-out forwards;
        }
        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-full {% block body_class %}{% endblock %}" style="{% block body_style %}{% endblock %}">
    <div class="min-h-full relative z-10">
        <nav class="nav-glass sticky top-0 z-50 shadow-lg" role="navigation" aria-label="Main menu">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <a href="{{ url_for('dashboard') }}" class="flex items-center space-x-3 group">
                            <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-sm group-hover:shadow-lg transition-all duration-200 temporal-glow">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" aria-hidden="true"></path>
                                </svg>
                            </div>
                            <h1 class="text-white text-xl font-semibold hidden sm:block text-temporal">
                                JobSnap
                            </h1>
                        </a>
                        <div class="hidden md:block ml-10">
                            <div class="flex items-center space-x-1">
                                {% if current_user.is_authenticated %}
                                <a href="{{ url_for('dashboard') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-200">Dashboard</a>
                                <a href="{{ url_for('profile') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-200">Profile</a>
                                <a href="{{ url_for('outreach_studio') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-200">Outreach Studio</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        {% if current_user.is_authenticated %}
                        <div class="hidden md:flex items-center space-x-3">
                            <div class="text-sm text-gray-400">Welcome back!</div>
                            <a href="{{ url_for('logout') }}" class="inline-flex items-center px-3 py-2 border border-gray-600 shadow-sm text-sm font-medium rounded-lg text-gray-300 bg-gray-800/50 hover:bg-gray-700/50 transition-colors">
                                Sign out
                            </a>
                        </div>
                        {% else %}
                        <div class="hidden md:flex items-center space-x-3">
                            <a href="{{ url_for('login') }}" class="text-gray-300 hover:text-white px-3 py-2 text-sm font-medium transition-colors">Sign in</a>
                            <a href="{{ url_for('register') }}" class="btn-temporal inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg shadow-sm">
                                Get started
                            </a>
                        </div>
                        {% endif %}
                        <div class="md:hidden">
                            <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-300 hover:bg-gray-800/50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 transition-colors" aria-controls="mobile-menu" aria-expanded="false">
                                <span class="sr-only">Open main menu</span>
                                <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                                <svg class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div class="md:hidden hidden mobile-menu-dark" id="mobile-menu" role="navigation" aria-label="Mobile menu">
                <div class="px-4 pt-2 pb-3 space-y-1">
                    {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dashboard') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 block rounded-lg px-3 py-2 text-base font-medium">Dashboard</a>
                    <a href="{{ url_for('profile') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 block rounded-lg px-3 py-2 text-base font-medium">Profile</a>
                    <a href="{{ url_for('outreach_studio') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 block rounded-lg px-3 py-2 text-base font-medium">Outreach Studio</a>
                    <div class="border-t border-gray-700 pt-2 mt-2">
                        <a href="{{ url_for('logout') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 block rounded-lg px-3 py-2 text-base font-medium">Sign out</a>
                    </div>
                    {% else %}
                    <a href="{{ url_for('login') }}" class="text-gray-300 hover:text-white hover:bg-gray-800/50 block rounded-lg px-3 py-2 text-base font-medium">Sign in</a>
                    <a href="{{ url_for('register') }}" class="btn-temporal block rounded-lg px-3 py-2 text-base font-medium">Get started</a>
                    {% endif %}
                </div>
            </div>
        </nav>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}" role="alert">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        <main class="flex-1" id="main-content">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    <!-- Alpine.js Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const openIcon = mobileMenuButton.querySelector('svg.block');
        const closeIcon = mobileMenuButton.querySelector('svg.hidden');

        mobileMenuButton.addEventListener('click', () => {
            const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
            mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
            mobileMenu.classList.toggle('hidden');
            openIcon.classList.toggle('hidden');
            openIcon.classList.toggle('block');
            closeIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('block');
        });

        // Add temporal hover effects to interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            const interactiveElements = document.querySelectorAll('button, .btn-temporal, a');
            
            interactiveElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    this.style.transition = 'all 0.3s ease';
                });
            });
        });
        
        // --- Dynamic Toast Notification System ---
        function showToast(message, type = 'info', triggerElement = null) {
            // --- Card Background Highlight ---
            let cardBackdrop = null;
            const jobCard = triggerElement ? triggerElement.closest('.job-item') : null;

            // Remove any existing toast
            const existingToast = document.getElementById('dynamic-toast');
            if (existingToast) {
                existingToast.remove();
            }
            const existingBackdrop = document.querySelector('.toast-card-backdrop');
            if (existingBackdrop) {
                existingBackdrop.remove();
            }
            
            // Create the toast element
            const toast = document.createElement('div');
            toast.id = 'dynamic-toast';
            toast.setAttribute('role', 'status');
            toast.setAttribute('aria-live', 'polite');

            // Base classes for a minimalistic design
            let classes = 'absolute z-[1001] px-4 py-2.5 rounded-md shadow-lg text-sm font-medium transition-all duration-300 ease-in-out';
            
            // Type-specific classes
            const typeStyles = {
                success: 'bg-emerald-500/10 text-emerald-300 border border-emerald-500/20',
                error: 'bg-red-500/10 text-red-300 border border-red-500/20',
                warning: 'bg-amber-500/10 text-amber-300 border border-amber-500/20',
                info: 'bg-sky-500/10 text-sky-300 border border-sky-500/20'
            };
            toast.className = `${classes} ${typeStyles[type] || typeStyles.info}`;
            toast.textContent = message;

            // Initial state for animation
            toast.style.opacity = '0';
            toast.style.transform = 'translateY(10px)';

            document.body.appendChild(toast);

            // --- Create and animate card backdrop if a job card is found ---
            if (jobCard) {
                cardBackdrop = document.createElement('div');
                cardBackdrop.className = 'toast-card-backdrop fixed bg-indigo-500/10 rounded-2xl z-[1] transition-all duration-300 ease-in-out';
                const cardRect = jobCard.getBoundingClientRect();
                cardBackdrop.style.top = `${cardRect.top + window.scrollY}px`;
                cardBackdrop.style.left = `${cardRect.left + window.scrollX}px`;
                cardBackdrop.style.width = `${cardRect.width}px`;
                cardBackdrop.style.height = `${cardRect.height}px`;
                cardBackdrop.style.opacity = '0';
                cardBackdrop.style.transform = 'scale(0.98)';
                document.body.appendChild(cardBackdrop);
                requestAnimationFrame(() => {
                    cardBackdrop.style.opacity = '1';
                    cardBackdrop.style.transform = 'scale(1)';
                });
            }

            // Position the toast
            if (triggerElement) {
                const rect = triggerElement.getBoundingClientRect();
                const toastHeight = toast.offsetHeight;
                const toastWidth = toast.offsetWidth;
                const spaceAbove = rect.top;

                let topPosition;
                // Prefer to show above if there's enough space (toast height + 15px margin), otherwise show below.
                if (spaceAbove > toastHeight + 15) {
                    topPosition = rect.top + window.scrollY - toastHeight - 10;
                } else {
                    topPosition = rect.bottom + window.scrollY + 10;
                }
                toast.style.top = `${topPosition}px`;

                // Center horizontally, but clamp to viewport edges to prevent overflow.
                let leftPosition = rect.left + (rect.width / 2) - (toastWidth / 2);
                leftPosition = Math.max(10, leftPosition); // Ensure it's not off-screen to the left
                leftPosition = Math.min(leftPosition, window.innerWidth - toastWidth - 10); // Ensure it's not off-screen to the right
                toast.style.left = `${leftPosition}px`;
            } else {
                // Fallback to top-center of the viewport
                toast.style.top = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%) translateY(10px)';
                toast.style.position = 'fixed'; // Fallback to fixed if no trigger
            }

            // Animate in
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                toast.style.transform = triggerElement ? 'translateY(0)' : 'translateX(-50%) translateY(0)';
            });

            // Animate out and remove
            const hideToast = () => {
                toast.style.opacity = '0';
                toast.style.transform = triggerElement ? 'translateY(-10px)' : 'translateX(-50%) translateY(-10px)';
                setTimeout(() => {
                    toast.remove();
                    if (cardBackdrop) cardBackdrop.remove();
                }, 350); // Slightly longer to match backdrop fade
            };

            setTimeout(hideToast, 3500); // Toast visible for 3.5 seconds
        }
    </script>
</body>
</html>